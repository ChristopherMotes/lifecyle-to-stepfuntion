AWSTemplateFormatVersion: "2010-09-09"
Description: Run at new account creation
Resources:
    stepFunctionRole:
        Type: 'AWS::IAM::Role'
        Properties:
            RoleName: !Sub state-function-${AWS::StackName}
            AssumeRolePolicyDocument:
                Version: 2012-10-17
                Statement:
                    - Effect: Allow
                      Principal:
                        Service:
                        - states.amazonaws.com
                      Action:
                        - 'sts:AssumeRole'
            ManagedPolicyArns:
                - arn:aws:iam::aws:policy/service-role/AWSLambdaRole
                
    lambdaFunctionRole:
        Type: 'AWS::IAM::Role'
        Properties:
            RoleName: !Sub lambda-${AWS::StackName}
            AssumeRolePolicyDocument:
                Version: 2012-10-17
                Statement:
                    - Effect: Allow
                      Principal:
                        Service:
                        - lambda.amazonaws.com
                      Action:
                        - 'sts:AssumeRole'
            ManagedPolicyArns:
                - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
              
    myStateMachine:
        Type: AWS::StepFunctions::StateMachine
        Properties: 
            DefinitionString: |-
                {
                    "StartAt": "HelloWorld",
                    "States": {
                        "HelloWorld": {
                            "Type": "Pass",
                            "End": true
                        }
                    }
                }
            RoleArn: !GetAtt stepFunctionRole.Arn
            StateMachineName: !Ref AWS::StackName
            StateMachineType: STANDARD
